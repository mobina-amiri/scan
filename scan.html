<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>Ø§Ø³Ú©Ù† Ø¨Ø§Ø±Ú©Ø¯ Ùˆ Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ ESP</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
</head>
<body style="font-family: sans-serif; text-align:center; margin-top:50px;">
  <h2>ðŸ“· Ø§Ø³Ú©Ù† Ø¨Ø§Ø±Ú©Ø¯</h2>
  <div id="reader" style="width:300px; margin:auto;"></div>
  <p>ØªØ§Ø±ÛŒØ® Ø§Ù†Ù‚Ø¶Ø§: <span id="expiryDate">---</span></p>
  <button onclick="sendDate()">Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ ESP</button>

  <script>
    const ESP_IP = "192.168.43.98";  // Ø¢ÛŒâ€ŒÙ¾ÛŒ Ø«Ø§Ø¨Øª ESP8266
    let expiryDate = "";

    function onScanSuccess(decodedText) {
      expiryDate = decodedText;
      document.getElementById("expiryDate").innerText = expiryDate;
    }

    // Ø´Ø±ÙˆØ¹ Ø§Ø³Ú©Ù† Ø¨Ø§ Ø¯ÙˆØ±Ø¨ÛŒÙ†
    const html5QrCode = new Html5Qrcode("reader");
    html5QrCode.start(
      { facingMode: "environment" },
      { fps: 10, qrbox: 250 },
      onScanSuccess
    );

    // Ø§Ø±Ø³Ø§Ù„ ØªØ§Ø±ÛŒØ® Ø¨Ù‡ ESP
    function sendDate() {
      if (!expiryDate) {
        alert("Ø§ÙˆÙ„ Ø¨Ø§Ø±Ú©Ø¯ Ø±Ùˆ Ø§Ø³Ú©Ù† Ú©Ù†!");
        return;
      }
      fetch(`http://${ESP_IP}/expire?date=${expiryDate}`)
        .then(res => res.text())
        .then(data => alert("Ù¾Ø§Ø³Ø® Ø§Ø² ESP: " + data))
        .catch(err => alert("Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ ESP: " + err));
    }
  </script>
</body>
</html>

